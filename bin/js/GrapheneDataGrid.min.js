function GrapheneDataGrid(t){this.version="0.0.2",this.eventBus=new gform.eventBus({owner:"table",item:"model",handlers:t.events||{}},this),this.on=this.eventBus.on,"object"==typeof(t=_.extend({filter:!0,sort:!0,search:!0,download:!0,upload:!0,columns:!0,id:gform.getUID()},t)).actions&&t.actions.length?t.actions=_.map(t.actions,function(t){return _.extend({global:!1},t)}):t.actions=!1;var e=!1;if(window.localStorage&&t.name)try{e=JSON.parse(localStorage.getItem("bt_"+t.name))}catch(t){}"string"!=typeof t.item_template&&(window.outerWidth>767||0==window.outerWidth?t.item_template=gform.stencils.table_row:t.item_template=gform.stencils.mobile_row),this.filterValues={},this.draw=function(){_.each(this.summary.items,function(t){this.$el.find(".filter #"+t.id+",[data-sort="+t.id+"]").toggle(t.isEnabled)}.bind(this)),t.search=this.filterValues,_.each(t.search,function(e,i){e||0===e||delete t.search[i]});var e=t.pagebuffer||2;this.$el.find('[name="search"]').length&&this.$el.find('[name="search"]').val().length?this.searchAll(this.$el.find('[name="search"]').val()):this.search(t);var i={};t.pagecount=Math.ceil(this.lastGrabbed/t.count),i.pages=[],t.page>t.pagecount&&(t.page=t.pagecount||1);var s=this.lastGrabbed>t.count*t.page?t.count*t.page:this.lastGrabbed,n=document.createDocumentFragment();_.each(this.grab(t),function(t){n.appendChild(t.draw())}),this.$el[0].querySelector(".list-group").innerHTML="",this.$el[0].querySelector(".list-group").appendChild(n);var a=t.page-e;a<1&&(a=1);var r=t.page+e;r>t.pagecount&&(r=t.pagecount);for(var o=a;o<=r;o++){var l={name:o};t.page==o&&(l.active="active"),i.pages.push(l)}i.size=this.lastGrabbed,i.last=s,i.first=t.count*(t.page-1)+1,i.multiPage=r>a,i.isFirst=1==t.page,i.isLast=t.page==t.pagecount,i.showLast=t.pagecount==r,i.showFirst=1==a,i.checked_count=this.getSelected().length,i.entries=_.map(t.entries,function(e){return{value:e,selected:e==t.count}},t),this.renderObj=i,this.updateCount(),this.$el.find(".paginate-footer").html(gform.render("table_footer",this.renderObj)),this.fixStyle(),window.localStorage&&t.name&&localStorage.setItem("bt_"+t.name,JSON.stringify(this.state.get()))};var i=function(e){switch(e.stopPropagation(),e.currentTarget.dataset.page){case"inc":t.page++,t.page>t.pagecount&&(t.page=t.pagecount);break;case"dec":t.page--,t.page<1&&(t.page=1);break;default:t.page=e.currentTarget.dataset.page||t.pagecount}this.draw()},s=function(e,i){if(void 0===e||1==e)this.$el.find(".reverse, [data-sort]").removeClass("text-primary").find("i").attr("class","fa fa-sort text-muted"),this.$el.find(".sortBy").val("true"),t.reverse=!1;else{void 0===i?t.sort==e?t.reverse=!t.reverse:t.reverse=!1:t.reverse=i;var s=this.$el.find(".reverse, [data-sort="+_.find(this.options.filterFields,{search:e}).id+"]");void 0!==s&&(t.reverse?s.find("i").attr("class","fa fa-sort-asc"):s.find("i").attr("class","fa fa-sort-desc"),s.siblings("[data-sort]").removeClass("text-primary"),s.siblings("[data-sort]").find("i").attr("class","fa fa-sort text-muted"),s.addClass("text-primary"))}t.sort=e,this.draw()}.bind(this);void 0!==(t=_.extend({count:t.count||25,page:1,sort:"createdAt",reverse:!1},t)).filters&&(t.filters=_.map(t.filters,function(t){t.type=t.type||"text";var e=_.assignIn({name:(gform.renderString(t.label)||"").toLowerCase().split(" ").join("_"),id:gform.getUID(),label:t.legend||t.name,validate:[],valid:!0,parsable:!0,visible:!0,enabled:!0,array:!1,offset:0},this.opts,gform.default,(gform.types[t.type]||gform.types.text).defaults,t);return""==e.name&&(e.name=e.id),e.item=t,e})),t.filterFields=_.map(_.extend({},t.filters||t.schema),function(t){switch(t=gform.normalizeField.call({options:{default:{type:"text"}}},t),name=t.name,t.value="",t.type){case"checkbox":t.options=[{label:"False",value:"false"},{label:t.options[0]||"True",value:t.options[1]||"true"}];case"radio":t.type="select";case"select":t.placeholder=!1,t.options=[{type:"optgroup",options:[{label:"No Filter",value:null}],format:{label:"{{label}}"}},{type:"optgroup",options:t.options}];break;case"hidden":break;default:t.type="text"}return t.options&&"object"==typeof t.options&&(t.options=_.map(t.options,function(t){return"object"==typeof t?_.omit(t,"selected"):t})),t.id=t.id||gform.getUID(),t.search=t.name,t.name=t.id,t.show={},t.enabled=!0,t.help="",t}),"object"==typeof t.columns&&(t.filterFields=_.filter(t.filterFields,function(e){return _.includes(t.columns,e.name)||_.includes(t.columns,e.id)}));var n,a={"[[":"{{","]]":"}}",checked_count:0,multi_checked:!1,multiEdit:!!t.multiEdit,items:_.map(t.filterFields,function(t){var e=t.search||t.label.split(" ").join("_").toLowerCase();return e=t.template?t.template.replace(/{{value}}/gi,"{{attributes."+e+"}}"):"{{attributes."+e+"}}",{isEnabled:void 0===t.showColumn||t.showColumn,label:t.label,name:e,cname:t.name||t.label.split(" ").join("_").toLowerCase(),id:t.id,visible:!("hidden"==t.type)}})};t.hasActions=!!(t.edit||t.delete||t.events),void 0===t.hasEdit&&(t.hasEdit=!!t.edit),void 0===t.hasDelete&&(t.hasDelete=!!t.delete),t.entries=t.entries||[25,50,100],a.options=t,a.showAdd=!!t.add||t.showAdd,this.summary=a,n=t.template?n=gform.renderString(t.template,a):window.outerWidth>767||0==window.outerWidth?gform.render("table",a):gform.render("mobile_table",a);var r={add:function(){new gform(_.extend({},{name:"modal",table:this,actions:[{type:"cancel"},{type:"save"}],legend:'<i class="fa fa-pencil-square-o"></i> Create New',fields:t.schema},t.gform||{})).on("save",function(t){t.form.validate()&&(this.add(t.form.get(),{validate:!1}),t.form.pub("close"))}.bind(this)).on("cancel",function(t){t.form.pub("close")}).modal()},edit:function(){if(void 0!==this.options.multiEdit&&0!==this.options.multiEdit.length&&this.getSelected().length>1){if(void 0===this.options.multiEdit||0==this.options.multiEdit.length)return;var t=this.getSelected();if(0==t.length)return;var e=_.map(t,function(t){return t.attributes}),i=_.filter(this.options.multiEdit,function(t){return 1==_.uniq(_.map(e,t)).length}),s=_.filter(this.options.schema,function(t){return i.indexOf(t.name)>=0});s.length>0?new gform({legend:"("+t.length+") Common Field Editor",actions:[{type:"cancel"},{type:"save"}],fields:s,data:_.extend({},_.pick(t[0].attributes,i))}).on("save",function(e){var i=e.form.get();_.map(t,function(t){t.set(_.extend({},t.attributes,i)),this.eventBus.dispatch("model:edited",t)}.bind(this)),e.form.pub("close")}).on("close",function(){this.draw(),this.eventBus.dispatch("edited")}.bind(this)).on("cancel",function(t){t.form.pub("close")}).modal():$(gform.render("modal_container",{title:"Common Field Editor ",footer:'<div class="btn btn-danger" style="margin-right:20px" data-dismiss="modal">Done</div>',body:'<div class="alert alert-warning">No eligible fields have been found for editing.</div>'})).modal()}else new gform(_.extend({},{name:"modal",actions:[{type:"cancel"},{type:"save"}],legend:'<i class="fa fa-pencil-square-o"></i> Edit',data:this.getSelected()[0].attributes,fields:this.getSelected()[0].schema},this.options.gform||{})).on("save",function(t){this.getSelected()[0].set(t.form.toJSON()),this.eventBus.dispatch("edited"),this.eventBus.dispatch("model:edited",his.getSelected()[0]),this.draw(),t.form.pub("close")}.bind(this)).on("cancel",function(t){t.form.pub("close")}).modal()},delete:function(){var t=this.getSelected();t.length&&confirm("Are you sure you want to delete "+t.length+" records? \nThis operation can not be undone.\n\n")&&(_.each(t,function(t){t.delete()}),this.eventBus.dispatch("deleted"),this.draw())},mark:function(t){t.model.toggle()}};function o(e,i){var s,n,a=this.files;window.FileReader?(s=a[0],(n=new FileReader).readAsText(s),n.onload=function(i){var s=i.target.result,n=CSVToArray(s),a=!0;$("#myModal").remove();var r=$(gform.stencils.modal.render({title:"Importing CSV ",footer:'<div class="btn btn-danger" data-dismiss="modal">Cancel</div>',body:'<div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 0%"><span class="sr-only">50% Complete</span></div></div><div class="status">Validating Items...</div>'}));r.modal(),r.on("hidden.bs.modal",function(){this.importing=!1}.bind(this));var o=n.length-1,l=2*o,d=[];this.importing=!0,n[0]=_.map(n[0],function(e){var i=_.find(t.schema,{label:e});return i=null==i?e:i.name});for(var h=1;h<n.length;h++){if(!this.importing)return!1;if(n[0].length==n[h].length){var c={};for(var f in n[0])c[n[0][f]]=n[h][f];if(!(a=e.validate(c)))break;d.push(a)}else o--;r.find(".progress-bar").width(h/l*100+"%")}if(!a)return r.find(".btn").html("Done"),void r.find(".status").html('<div class="alert alert-danger">Error(s) in row '+h+", failed to validate!<ul><li>"+_.filter(e.errors,function(t){return t.length}).join("</li><li>")+"</li></div>");for(r.find(".status").html("Adding Items..."),h=0;h<d.length;h++){if(!this.importing)return!1;e.add(d[h],{draw:!1}),r.find(".progress-bar").width((h+o)/l*100+"%")}r.find(".status").html('<div class="alert alert-success">Successfully processed file, '+o+" rows were added!</div>"),r.find(".btn").toggleClass("btn-danger btn-success").html("Done"),r.find(".progress").hide(),void 0!==e.options.defaultSort&&(e.models=_.sortBy(e.models,function(t){return t.attributes[this.options.defaultSort]}.bind(e)).reverse()),"function"==typeof e.options.onBulkLoad&&e.options.onBulkLoad()},n.onerror=function(t){"NotReadableError"==t.target.error.name&&alert("Canno't read file !")},i.currentTarget.value=""):alert("FileReader is not supported in this browser."),e.draw()}this.validate=function(e){var i=!1,s=new gform({fields:t.schema,attributes:e});return s.validate()?i=s.toJSON():(this.errors=s.errors,console.log("Model not valid")),s.destroy(),i},this.add=function(t,e){var i=new tableModel(this,t,{"*":[function(t){t.model.owner.eventBus.dispatch("model:"+t.event,t.model)}],check:[function(t){t.model.owner.draw()}]});return!(0!=e.validate&&!this.validate(t))&&(this.models.push(i),void 0!==this.options.defaultSort&&(this.models=_.sortBy(this.models,function(t){return t.attributes[this.options.defaultSort]}.bind(this)).reverse()),!1!==e.draw&&this.draw(),!0!==e.silent&&this.eventBus.dispatch("added",i),i)},this.search=function(t){var e=_.sortBy(this.getModels(),function(e){return e.attributes[t.sort]});t.reverse||(e=e.reverse()),filterMap=this.filterMap,e=_.filter(e,function(e){var i=_.isEmpty(t.search);for(var s in t.search){if(!(i=_.filter(t.filterFields,{id:s})[0]&&void 0===_.filter(t.filterFields,{id:s})[0].options?_.score((e.display[this.filterMap[s]]+"").replace(/\s+/g," ").toLowerCase(),(t.search[s]+"").toLowerCase())>.4:e.display[this.filterMap[s]]+""==t.search[s]+""||e.attributes[this.filterMap[s]]+""==t.search[s]+""))break}return i}),this.lastGrabbed=e.length,this.filtered=e},this.find=function(t){var e=_.keys(t);return _.filter(this.getModels(),function(i){return _.isEqual(t,_.pick(i.attributes,e))})},this.searchAll=function(e){t.sort=null,this.$el.find("[data-sort]").removeClass("text-primary"),this.$el.find("[data-sort]").find("i").attr("class","fa fa-sort text-muted"),this.filter&&this.filter.set(),e=e.toLowerCase(),_.map(this.getModels(),function(i){for(var s in i.score=0,t.filterFields)i.score+=_.score((i.display[t.filterFields[s].search]+"").replace(/\s+/g," ").toLowerCase(),e)}),this.filtered=_.filter(_.sortBy(this.getModels(),"score"),function(t){return t.score>0}).reverse(),this.lastGrabbed=this.filtered.length},this.fixStyle=function(){if(this.options.autoSize)try{var t=this.$el.find(".table-container > div"),e=this.$el.find(".table-container > table tr th:visible"),i=this.$el.find(".list-group-row th");this.$el.find(".table-container table").removeClass("table-fixed"),t.css("width","auto"),t.css("minWidth","auto"),e.css("width","auto"),e.css("minWidth","85px"),this.$el.find(".table-container > table tr th.select-column").css("minWidth","60px"),this.$el.find(".table-container > table tr th.select-column").css("width","60px"),i.css("width","auto"),i.css("minWidth","auto"),t.css("height",$(window).height()-t.offset().top-(88+this.options.autoSize)+"px"),_.each(i,function(t,i){void 0!==e[i]?(t.style.display="table-cell",e[i].offsetWidth>t.offsetWidth?($(t).css("width",e[i].offsetWidth+"px"),$(t).css("minWidth",e[i].offsetWidth+"px"),$(e[i]).css("width",e[i].offsetWidth+"px"),$(e[i]).css("minWidth",e[i].offsetWidth+"px")):($(e[i]).css("width",e[i].offsetWidth+"px"),$(e[i]).css("minWidth",e[i].offsetWidth+"px"),$(t).css("width",e[i].offsetWidth+"px"),$(t).css("minWidth",e[i].offsetWidth+"px"))):t.style.display="none"}.bind(this)),this.$el.find(".table-container table").addClass("table-fixed");var s=this.$el.find(".table-container > div table")[0].offsetWidth;this.$el.find(".table-container > table")[0].offsetWidth>s&&(s=this.$el.find(".table-container > table")[0].offsetWidth),t.css("width",s+"px"),t.css("minWidth",s+"px"),s>this.$el.find(".table-container")[0].offsetWidth?this.$el.find(".table-container").css("overflow","auto"):this.$el.find(".table-container").css("overflow","hidden")}catch(t){}},this.grab=function(t){return this.filtered.slice(t.count*(t.page-1),t.count*(t.page-1)+t.count)},this.getModels=function(t){t=t||{deleted:!1};return _.filter(this.models,t)},this.getSelected=function(){return this.getModels({checked:!0,deleted:!1})},this.destroy=function(){this.$el.find(".list-group").empty(),this.$el.off(),this.$el.empty()},this.state={get:function(){var e={count:this.options.count,page:this.options.page};return this.$el.find('[name="search"]').length&&this.$el.find('[name="search"]').val().length?e.search=this.$el.find('[name="search"]').val():(e.sort=t.sort,e.reverse=t.reverse,void 0!==this.filter&&(e.filters={},_.each(this.options.filterFields,function(t){e.filters[t.search]=this[t.id]}.bind(this.filter.toJSON())))),e.columns=_.map(_.map(_.filter(this.summary.items,function(t){return t.isEnabled}),"id"),function(t){return _.find(this.options.filterFields,{id:t}).search}.bind(this)),e}.bind(this),set:function(e){void 0!==e.columns&&e.columns.length&&(this.summary.items=_.map(this.summary.items,function(t){return t.isEnabled=_.includes(e.columns,this.filterMap[t.cname]),t}),this.view=gform.renderString(t.item_template,a),this.$el.find('.columnEnables [type="checkbox"]').each(function(t){this.checked=!1}),t.columns&&_.each(e.columns,function(t){var e=this.$el.find('.columnEnables [data-field="'+_.find(this.options.filterFields,{search:t}).id+'"] [type="checkbox"]');e.length&&(e[0].checked=!0)}.bind(this))),void 0!==e.filters&&(this.filterValues={},_.each(e.filters,function(t,e){this.filterValues[_.find(this.options.filterFields,{search:e}).id]=t}.bind(this))),void 0!==e.sort&&s(e.sort||t.sort,e.reverse),void 0!==this.filter&&this.filter.set(this.filterValues),void 0!==e.search&&""!==e.search&&this.$el.find('[name="search"]').val(e.search),this.options.page=e.page||this.options.page,this.options.count=e.count||this.options.count,this.draw()}.bind(this)},this.models=[],this.options=t,this.filterMap={},_.map(t.filterFields,function(t){this.filterMap[t.id]=t.search}.bind(this)),this.getCSV=function(t){"string"!=typeof t&&(t=this.options.title),_.csvify(_.map(this.filtered,function(t){return t.attributes}),_.map(_.filter(this.summary.items,function(t){return t.isEnabled}),function(t){return{label:t.label,name:this.filterMap[t.cname]}}),t)};var l=document.querySelector(t.container);null!==l&&(l.innerHTML=gform.renderString(n,a),function(e){if(this.$el=e,e.find(".filter").length&&(this.filter=new gform({name:"filter"+this.options.id,clear:!1,fields:t.filterFields,default:{hideLabel:!0,type:"text",format:{label:"{{label}}",value:"{{value}}"}}},".filter").on("change",function(){this.$el.find('[name="search"]').val(""),this.filterValues=this.filter.toJSON(),this.draw()}.bind(this)),this.filter.set()),this.updateCount=function(t){t=t||this.getSelected().length,this.summary.checked_count=t,this.summary.multi_checked=t>1,this.$el.find('[name="actions"]').html(gform.render("actions",this.summary)),this.$el.find('[name="count"]').html(gform.render("count",this.summary));var e=this.$el.find('[name="select_all"].fa');t>0&&t==this.getModels().length?e.attr("class","fa fa-2x fa-check-square-o"):0==t?e.attr("class","fa fa-2x fa-square-o"):e.attr("class","fa fa-2x fa-minus-square-o")},this.view=gform.renderString(t.item_template,a),t.data)for(var n in t.data)this.models.push(new tableModel(this,t.data[n],{"*":[function(t){t.model.owner.eventBus.dispatch("model:"+t.event,t.model)}],check:[function(t){t.model.owner.draw()}]}));void 0!==this.options.defaultSort&&(this.models=_.sortBy(this.models,function(t){return t.attributes[this.options.defaultSort]}.bind(this)).reverse()),this.$el.on("change",".csvFileInput",_.partial(o,this)),this.$el.on("click",'[name="bt-upload"]',function(){this.$el.find(".csvFileInput").click()}.bind(this)),this.$el.on("click",'[name="bt-download"]',this.getCSV.bind(this)),this.$el.on("click","[data-page]",i.bind(this)),this.$el.on("click",".columnEnables label",function(e){e.stopPropagation(),_.find(this.summary.items,{id:e.currentTarget.dataset.field}).isEnabled=e.currentTarget.childNodes[0].checked,this.view=gform.renderString(t.item_template,a),this.draw()}.bind(this)),this.$el.on("click",".grid-row",function(t){this.eventBus.dispatch("click",_.find(this.models,{id:t.currentTarget.dataset.id}))}.bind(this)),this.$el.on("change",'[name="count"]',function(e){t.count=parseInt(e.currentTarget.value,10),this.draw()}.bind(this)),this.$el.on("input",'[name="search"]',_.debounce(function(t){this.draw()}.bind(this),300)),this.$el.on("click",'[name="select_all"]',function(t){var e=this.getSelected();e.length||0==this.getModels().length?_.each(e,function(t){t.toggle(!1,!0)}):_.each(this.filtered,function(t){t.toggle(!0,!0)}),this.draw()}.bind(this)),this.$el.on("click",'[name="reset-search"]',function(){this.$el.find('[name="search"]').val(""),this.filter&&this.filter.set(),this.filterValues={},s()}.bind(this)),this.dispatch=function(t,e){var i;void 0===e&&(e={event:t}),_.each(this.getSelected(),function(t){this.eventBus.dispatch("model:"+e.event,t)}.bind(this)),void 0!==e.id&&(i=_.find(this.models,{id:e.id}));var s=this.eventBus.dispatch(t,i,e);s.default&&void 0!==r[t]&&r[t].call(this,s)},this.$el.on("click","[data-event]",function(t){t.stopPropagation(),t.preventDefault();var e=_.assign({},t.currentTarget.dataset);this.dispatch(e.event,e)}.bind(this)),this.$el.on("click","[data-sort]",function(t){t.stopPropagation(),t.preventDefault();var e=_.find(this.options.filterFields,{name:t.currentTarget.dataset.sort}).search;this.options.reverse&&this.options.sort==e?s():s(e)}.bind(this)),this.draw()}.call(this,$(l))),this.$el.find('[name="search"]').focus(),this.$el.find(".table-container > div").css("overflow","auto"),$(window).on("resize orientationChange",this.fixStyle.bind(this)),e&&this.state.set(e)}
_.mixin({score:function(t,e,n){if(n=n||0,0===e.length)return.9;if(e.length>t.length)return 0;for(var r=e.length;r>0;r--){var i=e.substring(0,r),a=t.indexOf(i);if(!(a<0)&&!(a+e.length>t.length+n)){var l=t.substring(a+i.length),s=null;s=r>=e.length?"":e.substring(r);var o=_.score(l,s,n+a);if(o>0){var u=t.length-l.length;if(0!==a){var c=t.charCodeAt(a-1);if(32==c||9==c)for(var h=a-2;h>=0;h--)u-=32==(c=t.charCodeAt(h))||9==c?1:.15;else u-=a}return u+=o*l.length,u/=t.length}}}return 0},csvToArray:function(t){for(var e=function(t){for(var e=0;e<t.length;e++)t[e]=_.trim(t[e],'"');return t},n=t.split(/\n/),r=e(n.shift().split(",")),i=[];n.length;){var a=e(n.shift().split(",")),l=_.zipObject(r,a);i.push(l)}return i},csvify:function(t,e,n){var r='"'+_.map(e,"label").join('","')+'"\n';labels=_.map(e,"name");var i=_.zipObject(labels,_.map(labels,function(){return""}));r+=_.map(t,function(t){return JSON.stringify(_.values(_.extend(i,_.pick(t,labels))))},this).join("\n").replace(/(^\[)|(\]$)/gm,"").split('"').join("");var a=document.createElement("a");return a.setAttribute("href","data:text/csv;charset=utf-8,"+encodeURIComponent(r)),a.setAttribute("download",(n||"GrapheneDataGrid")+".csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),!0}});
function tableModel(t,i,e){this.owner=t,this.id=gform.getUID(),this.attributes={},this.display={},this.attribute_history=[],this.schema=t.options.schema,this.iswaiting,this.row=document.createElement("tr"),this.row.setAttribute("data-id",this.id),this.row.setAttribute("class","filterable grid-row"+(this.iswaiting?" warning":"")),this.waiting=function(t){return void 0!==t&&(this.iswaiting=t,this.row.setAttribute("class","filterable grid-row"+(this.iswaiting?" warning":"")),this.draw()),this.iswaiting},this.draw=function(){var t=gform.renderString(this.owner.view,this);return this.row.innerHTML!=t&&(this.row.innerHTML=t),this.row},this.eventBus=new gform.eventBus({owner:"model",item:"model",handlers:e||{}},this),this.on=this.eventBus.on,this.dispatch=this.eventBus.dispatch;var s=function(){_.each(this.schema,function(t){if(void 0!==t.options){var i;if(void 0!==t.value_key)if("index"==t.value_key)i=t.options[this.attributes[t.name]];else{var e={};e[t.value_key]=this.attributes[t.name],i=_.find(t.options,e),_.isFinite(this.attributes[t.name])&&(e[t.value_key]=parseInt(this.attributes[t.name]),void 0===i&&(i=_.find(t.options,e)),void 0===i&&(i=_.find(t.options,e)))}else void 0===(i=_.find(t.options,{value:this.attributes[t.name]}))&&(i=_.find(t.options,{id:this.attributes[t.name]})),_.isFinite(this.attributes[t.name])&&(void 0===i&&(i=_.find(t.options,{value:parseInt(this.attributes[t.name],10)})),void 0===i&&(i=_.find(t.options,{id:parseInt(this.attributes[t.name],10)})));this.display[t.name]="object"==typeof i?i[t.label_key]||i.label||i.name:this.attributes[t.name]}else t.template?this.display[t.name]=gform.renderString(t.template):this.display[t.name]=this.attributes[t.name]}.bind(this))};this.set=function(t,i){void 0!==t&&(this.attribute_history.push(_.extend({},this.attributes)),this.attributes=t),s.call(this),this.draw(),i||this.dispatch("set")},this.checked=!1,this.deleted=!1,this.toggle=function(t,i){this.checked="bool"==typeof t?t:!this.checked,this.draw(),i||this.dispatch("check")},this.set(i),s.call(this),this.toJSON=function(){return this.attributes},this.undo=function(){this.deleted?(this.deleted=!1,this.owner.draw()):this.attribute_history.length&&(this.attributes=this.attribute_history.pop(),s.call(this),this.owner.draw())},this.delete=function(){this.deleted=!0}}
gform.stencils.actions='<div>\n<span class="hidden-xs">\n{{#options.hasDelete}}\n<a href="javascript:void(0);" data-event="delete" class="btn btn-danger {{^checked_count}}disabled{{/checked_count}}" style="margin-right:15px"><i class="fa fa-times"></i> Delete</a>\n{{/options.hasDelete}}\n<div class="btn-group"role="group" aria-label="...">\n\n    {{#options.hasEdit}}<a href="javascript:void(0);" data-event="edit" class="btn btn-primary {{^checked_count}}disabled{{/checked_count}}{{^multiEdit}}{{#multi_checked}}disabled{{/multi_checked}}{{/multiEdit}}" data-id="{{[[}}id{{]]}}"><i class="fa fa-pencil"></i> Edit</a>{{/options.hasEdit}}\n\n    {{#options.actions}}\n      {{^global}}<a href="javascript:void(0);" data-event="{{name}}" class="custom-event btn btn-default {{^checked_count}}disabled{{/checked_count}}{{^multiEdit}}{{#multi_checked}}disabled{{/multi_checked}}{{/multiEdit}}" data-id="{{[[}}id{{]]}}">{{{label}}}</a>{{/global}}\n    {{/options.actions}}\n\n</div>\n</span>\n<div class="btn-group visible-xs">\n  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n    <i class="fa fa-cogs"></i> <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu">\n      {{#options.hasEdit}}<li  class=" {{^checked_count}}disabled{{/checked_count}}{{^multiEdit}}{{#multi_checked}}disabled{{/multi_checked}}{{/multiEdit}}"><a href="javascript:void(0);" data-event="edit" data-id="{{[[}}id{{]]}}"><i class="fa fa-pencil"></i> Edit</a></li> {{/options.hasEdit}}\n\n      {{#options.actions}}\n        {{^global}}<li class="{{^checked_count}}disabled{{/checked_count}}{{^multiEdit}}{{#multi_checked}}disabled{{/multi_checked}}{{/multiEdit}}"><a href="javascript:void(0);" data-event="{{name}}" class="custom-event" data-id="{{[[}}id{{]]}}">{{{label}}}</a></li>{{/global}}\n      {{/options.actions}}\n      {{#options.hasDelete}}\n        <li role="separator" class="divider"></li>\n        <li class=" {{^checked_count}}disabled{{/checked_count}}"><a href="javascript:void(0);" data-event="delete" style="margin-right:15px"><i class="fa fa-times"></i> Delete</a></li>\n      {{/options.hasDelete}}\n  </ul>\n</div>\n</div>\n',gform.stencils.count='{{#checked_count}}<h5 class="range label label-info checked_count" style="margin:7px 0">{{checked_count}} item(s) selected</h5>{{/checked_count}}',gform.stencils.mobile_head='\n<div style="clear:both;">\n\n  {{#options.sort}}\n\n  <div class="row" style="margin-bottom:10px">\n\n    <div class="col-xs-6">\n    {{#options.filter}}\n\n      <div name="reset-search" style="position:relative" class="btn btn-default" data-toggle="tooltip" data-placement="left" title="Clear Filters">\n        <i class="fa fa-filter"></i>\n        <i class="fa fa-times text-danger" style="position: absolute;right: 5px;"></i>\n      </div>    \n\n    <div class="btn btn-info filterForm">Filter</div>\n  {{/options.filter}}\n    </div>\n    <div class="col-xs-6">\n    \t\t{{#options.search}}<input type="text" name="search" class="form-control" style="" placeholder="Search">{{/options.search}}\n        </div>\n    </div>\n    <div class="input-group">\n      <span class="" style="display: table-cell;width: 1%;white-space: nowrap;vertical-align: middle;padding-right:5px">\n        <button class="btn btn-default reverse" type="button" tabindex="-1"><i class="fa fa-sort text-muted"></i></button>\n      </span>\n        <select class="form-control sortBy">\n          <option value=true>None</option>\n          {{#items}}\n            {{#visible}}\n              <option value="{{id}}">{{label}}</option>\n            {{/visible}}\n          {{/items}}\n        <select>\n    </div>\n  {{/options.sort}}\n\n</div>\n',gform.stencils.mobile_row='<tr><td colspan="100%" class="filterable">\t\t\n{{#options.hasActions}}\n<div data-event="mark" style="text-align:left;padding:0;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;">\n<span class="text-muted fa {{[[}}#checked{{]]}}fa-check-square-o{{[[}}/checked{{]]}} {{[[}}^checked{{]]}}fa-square-o{{[[}}/checked{{]]}}" style="margin:6px; cursor:pointer;font-size:24px"></span>\n</div>\n  {{/options.hasActions}}\n<div>\n{{#items}}\n{{#visible}}{{#isEnabled}}<div class="row" style="min-width:85px"><span class="col-sm-3"><b>{{label}}</b></span><span class="col-sm-9 col-xs-12">{{{name}}}</span></div>{{/isEnabled}}{{/visible}}\n{{/items}}\n</div>\n</td></tr>',gform.stencils.mobile_table='<div class="well table-well">\n<div style="height:40px;">\n  <div name="actions" class=" pull-left" style="margin-bottom:10px;width:62%" ></div>\n\n  <input type="file" class="csvFileInput" accept=".csv" style="display:none">\n\n  <div class="hiddenForm" style="display:none"></div>\n  <div class="btn-group pull-right" style="margin-bottom:10px" role="group" aria-label="...">\n    {{#showAdd}}\n    <div data-event="add" class="btn btn-success"><i class="fa fa-pencil-square-o"></i> New</div>\n    {{/showAdd}}\t\n\n    {{#options.actions}}\n      {{#global}}<div class="btn btn-default custom-event" data-event="{{name}}" data-id="{{[[}}id{{]]}}">{{{label}}}</div>{{/global}}\n    {{/options.actions}}\n    {{#options.download}}\n    <div class="btn btn-default hidden-xs" name="bt-download" data-toggle="tooltip" data-placement="left" title="Download"><i class="fa fa-download"></i></div>\n    {{/options.download}}\n    {{#options.upload}}\n    <div class="btn btn-default hidden-xs" name="bt-upload" data-toggle="tooltip" data-placement="left" title="Upload"><i class="fa fa-upload"></i></div>\n    {{/options.upload}}\n\n\n    {{#options.columns}}\n    <div class="btn-group columnEnables" data-toggle="tooltip" data-placement="left" title="Display Columns">\n      <button class="btn btn-default dropdown-toggle" type="button" id="enables_{{options.id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n        <i class="fa fa-list"></i>\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu pull-right" style="padding-top:10px" aria-labelledby="enables_{{options.id}}">\n        {{#items}}\n        {{#visible}}\n        <li><label data-field="{{id}}" style="width:100%;font-weight:normal"><input type="checkbox" {{#isEnabled}}checked="checked"{{/isEnabled}} style="margin: 5px 0 5px 15px;"> {{label}}</label></li>\n        {{/visible}}\n        {{/items}}\n      </ul>\n    </div>\n    {{/options.columns}}\n\n  </div>\n\n\n</div>\t\n    {{>mobile_head}}\n\n\n{{#options.hasActions}}\n<div style="padding: 16px 0 0 15px;"><i name="select_all" class="fa fa-2x fa-square-o"></i></div>\n{{/options.hasActions}}\n\n<div class="table-container" style="width:100%;overflow:auto">\n\n<div style="min-height:100px">\n  <table class="table {{^options.noborder}}table-bordered{{/options.noborder}} table-striped table-hover dataTable" style="margin-bottom:0px">\n    <tbody class="list-group">\n      <tr><td>\n        <div class="alert alert-info" role="alert">You have no items.</div>\n      </td></tr>\n    </tbody>\n\n  </table>\n</div>\n\n</div>\n<div class="paginate-footer" style="overflow:hidden;margin-top:10px"></div>\n</div>',gform.stencils.table='<div class="well table-well">\n<div style="overflow:hidden">\n  <div name="actions" class=" pull-left" style="margin-bottom:10px;width:62%" ></div>\n\n  <input type="file" class="csvFileInput" accept=".csv" style="display:none">\n\n  <div class="hiddenForm" style="display:none"></div>\n  <div class="btn-group pull-right" style="margin-bottom:10px;margin-left:10px" role="group" aria-label="...">\n    {{#showAdd}}\n    <div data-event="add" class="btn btn-success"><i class="fa fa-pencil-square-o"></i> New</div>\n    {{/showAdd}}\t\t\n    {{#options.actions}}\n      {{#global}}<div class="btn btn-default custom-event {{global}}" data-event="{{name}}" data-id="{{[[}}id{{]]}}">{{{label}}}</div>{{/global}}\n    {{/options.actions}}\n\n  </div>\n \n</div>\t\n<div>\n\n  <div class="btn-group pull-right" style="margin-bottom:10px;margin-left:10px" role="group" aria-label="...">\n\n    {{#options.download}}\n    <div class="btn btn-default hidden-xs" name="bt-download" data-toggle="tooltip" data-placement="left" title="Download"><i class="fa fa-download"></i></div>\n    {{/options.download}}\n    {{#options.upload}}\n    <div class="btn btn-default hidden-xs" name="bt-upload" data-toggle="tooltip" data-placement="left" title="Upload"><i class="fa fa-upload"></i></div>\n    {{/options.upload}}\n\n\n    {{#options.columns}}\n    <div class="btn-group columnEnables" data-toggle="tooltip" data-placement="left" title="Display Columns">\n      <button class="btn btn-default dropdown-toggle" type="button" id="enables_{{options.id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n        <i class="fa fa-list"></i>\n        <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu pull-right" style="padding-top:10px;padding-left:10px" aria-labelledby="enables_{{options.id}}">\n        {{#items}}\n        {{#visible}}\n        <li><label data-field="{{id}}" style="width:100%;font-weight:normal"><input type="checkbox" {{#isEnabled}}checked="checked"{{/isEnabled}}> {{label}}</label></li>\n        {{/visible}}\n        {{/items}}\n      </ul>\n    </div>\n    {{/options.columns}}\n  </div>\n  {{#options.search}}<input type="text" name="search" class="form-control pull-right" style="max-width:300px; margin-bottom:10px" placeholder="Search">{{/options.search}}\n\n  <span name="count"></span>\n</div>\n\n{{^options.autoSize}}\n<div class="paginate-footer hidden-xs" style="overflow:hidden;margin-top:10px;clear:both"></div>\n{{/options.autoSize}}\n\n<div class="table-container" style="width:100%;overflow:auto">\n{{#options.autoSize}}\n<table class="table {{^options.noborder}}table-bordered{{/options.noborder}}" style="margin-bottom:0px">\n<thead class="head">\n{{>table_head}}\n</thead>\n</table>\n{{/options.autoSize}}\n\n\n<div style="min-height:100px">\n  <table class="table {{^options.noborder}}table-bordered{{/options.noborder}} table-striped table-hover dataTable" style="margin-bottom:0px;{{#options.autoSize}}margin-top: -19px;{{/options.autoSize}}">\n    {{^options.autoSize}}\n    <thead class="head">\n    {{>table_head}}\n    </thead>\n    {{/options.autoSize}}\n{{#options.autoSize}}\n    <thead>\n          <tr  class="list-group-row">\n              {{#options.hasActions}}\n  <th style="width:60px" class="select-column"></th>\n  {{/options.hasActions}}\n        {{#items}}\n  {{#visible}}\n<th  style="min-width:85px">\n  {{/visible}}\n  {{/items}}\n  </tr>\n  </thead>\n{{/options.autoSize}}\n    <tbody class="list-group">\n      <tr><td>\n        <div class="alert alert-info" role="alert">You have no items.</div>\n      </td></tr>\n    </tbody>\n\n  </table>\n</div>\n\n</div>\n<div class="paginate-footer" style="overflow:hidden;margin-top:10px"></div>\n</div>',gform.stencils.table_footer='<div>\n{{#multiPage}}\n<nav class="pull-right" style="margin-left: 10px;">\n{{#size}}\n  <ul class="pagination" style="margin:0">\n    {{^isFirst}}\n    {{^showFirst}}<li class="pagination-first"><a data-page="1" href="javascript:void(0);" aria-label="First"><span aria-hidden="true">&laquo;</span></a></li>{{/showFirst}}\n    <li><a data-page="dec" href="javascript:void(0);" aria-label="Previous"><span aria-hidden="true">&lsaquo;</span></a></li>\n    {{/isFirst}}\n    {{#pages}}\n      <li class="{{active}}"><a data-page="{{name}}" href="javascript:void(0);">{{name}}</a></li>\n    {{/pages}}\n    {{^isLast}}\n    <li><a data-page="inc" href="javascript:void(0);" aria-label="Next"><span aria-hidden="true">&rsaquo;</span></a></li>\n    {{^showLast}}<li class="pagination-last"><a data-page="" href="javascript:void(0);" aria-label="Last"><span aria-hidden="true">&raquo;</span></a></li>{{/showLast}}\n    {{/isLast}}\n\n  </ul>\n{{/size}}\n</nav>\n\n{{/multiPage}}\t\n<h5 class="range badge {{^size}}alert-danger{{/size}} pull-left" style="margin-right:15px;">{{#size}}Showing {{first}} to {{last}} of {{size}} results{{/size}}{{^size}}No matching results{{/size}}</h5>\n  {{#entries.length}}\n  <span class="pull-left">\n    <select class="form-control" style="display:inline-block;width:auto;min-width:50px" name="count">\n    <option value="10000">All</option>\n    {{#entries}}\n    <option value="{{value}}" {{#selected}}selected="selected"{{/selected}}>{{value}}</option>\n    {{/entries}}\n\n    </select>\n    <span class="hidden-xs">results per page</span>\n  </span>\n  {{/entries.length}}\n</div>',gform.stencils.table_head='  <tr style="cursor:pointer" class="noselect table-sort">\n{{#options.hasActions}}\n<th style="width: 60px;min-width:60px;padding: 0 0 0 20px;" class="select-column"><i name="select_all" class="fa fa-2x fa-square-o"></i></th>\n{{/options.hasActions}}\n\n{{#items}}\n{{#visible}}\n<th {{#options.sort}}data-sort="{{cname}}"{{/options.sort}}><h6 style="margin: 2px;font-size:13px;white-space: nowrap">{{#options.sort}}<i class="fa fa-sort text-muted"></i> {{/options.sort}}{{label}}</h6></th>\n{{/visible}}\n{{/items}}\n</tr>\n{{#options.filter}}\n<tr class="filter">\n{{#options.hasActions}}<td>\n<div name="reset-search" style="position:relative" class="btn" data-toggle="tooltip" data-placement="left" title="Clear Filters">\n  <i class="fa fa-filter"></i>\n  <i class="fa fa-times text-danger" style="position: absolute;right: 5px;"></i>\n</div>\n</td>{{/options.hasActions}}\n\n{{#items}}\n{{#visible}}\n<td data-inline="{{cname}}" style="min-width:85px" id="{{id}}"></td>\n{{/visible}}\n{{/items}}\n</tr>\n{{/options.filter}}',gform.stencils.table_row='{{#options.hasActions}}\n\n<td data-event="mark" data-id="{{[[}}id{{]]}}" style="width: 60px;min-width:60px;text-align:left;padding:0;-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;">\n  <span class="text-muted fa {{[[}}#iswaiting{{]]}}fa-spinner fa-spin {{[[}}/iswaiting{{]]}} {{[[}}^iswaiting{{]]}} {{[[}}#checked{{]]}}fa-check-square-o{{[[}}/checked{{]]}} {{[[}}^checked{{]]}}fa-square-o{{[[}}/checked{{]]}}{{[[}}/iswaiting{{]]}} " style="margin:6px 0 6px 20px; cursor:pointer;font-size:24px"></span>\n   </td>\n\n  {{/options.hasActions}}\n{{#items}}\n{{#visible}}{{#isEnabled}}<td style="min-width:85px">{{{name}}}</td>{{/isEnabled}}{{/visible}}\n{{/items}}';
